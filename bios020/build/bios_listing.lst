F00:0001       .include "system.asm"
F01:0001       ;-----------------------------------------------------------------------------
F01:0002       ;Base definitions
F01:0003       ROM_BASE        = $00000000
F01:0004       ROM_SIZE        = $00040000
F01:0005       ROM_TOP         =  ROM_BASE + ROM_SIZE
F01:0006       
F01:0007       RAM_BASE        = $10000000
F01:0008       RAM_SIZE        = $00100000
F01:0009       RAM_TOP         = RAM_BASE + RAM_SIZE
F01:0010       RAM_PAGES       = RAM_SIZE / 1024
F01:0011       
F01:0012       MFP_BASE        = $40000000
F01:0013       
F01:0014       IDE0_BASE	= $20000000
F01:0015       IDE1_BASE	= $30000000
F01:0016       
F01:0017       STACK_INIT	= RAM_TOP
F01:0018       ;-----------------------------------------------------------------------------
F01:0019       ;MFP registers
F01:0020       MFP_GPDR        = MFP_BASE + $00
F01:0021       MFP_AER         = MFP_BASE + $01
F01:0022       MFP_DDR         = MFP_BASE + $02
F01:0023       MFP_IERA        = MFP_BASE + $03
F01:0024       MFP_IERB        = MFP_BASE + $04
F01:0025       MFP_IPRA        = MFP_BASE + $05
F01:0026       MFP_IPRB        = MFP_BASE + $06
F01:0027       MFP_ISRA        = MFP_BASE + $07
F01:0028       MFP_ISRB        = MFP_BASE + $08
F01:0029       MFP_IMRA        = MFP_BASE + $09
F01:0030       MFP_IMRB        = MFP_BASE + $0A
F01:0031       MFP_VR          = MFP_BASE + $0B
F01:0032       MFP_TACR        = MFP_BASE + $0C
F01:0033       MFP_TBCR        = MFP_BASE + $0D
F01:0034       MFP_TCDCR       = MFP_BASE + $0E
F01:0035       MFP_TADR        = MFP_BASE + $0F
F01:0036       MFP_TBDR        = MFP_BASE + $10
F01:0037       MFP_TCDR        = MFP_BASE + $11
F01:0038       MFP_TDDR        = MFP_BASE + $12
F01:0039       MFP_SCR         = MFP_BASE + $13
F01:0040       MFP_UCR         = MFP_BASE + $14
F01:0041       MFP_RSR         = MFP_BASE + $15
F01:0042       MFP_TSR         = MFP_BASE + $16
F01:0043       MFP_UDR         = MFP_BASE + $17
F01:0044       ;-----------------------------------------------------------------------------
F01:0045       ;IDE registers
F01:0046       IDE_D		= IDE0_BASE + $00
F01:0047       IDE_E		= IDE0_BASE + $02 ;read only
F01:0048       IDE_SC		= IDE0_BASE + $04
F01:0049       IDE_SN		= IDE0_BASE + $06
F01:0050       IDE_CL		= IDE0_BASE + $08
F01:0051       IDE_CH		= IDE0_BASE + $0A
F01:0052       IDE_SDH		= IDE0_BASE + $0C
F01:0053       IDE_STAT	= IDE0_BASE + $0E ;read only
F01:0054       IDE_WP		= IDE0_BASE + $02 ;write only
F01:0055       IDE_CMD		= IDE0_BASE + $0E ;write only
F01:0056       
F01:0057       IDE_ASTAT	= IDE1_BASE + $0C ;read only
F01:0058       IDE_DIGO	= IDE1_BASE + $0C ;write only
F01:0059       IDE_DRVA	= IDE1_BASE + $0E ;read only
F01:0060       
F01:0061       IDE_LBAL	= IDE0_BASE + $06
F01:0062       IDE_LBAM	= IDE0_BASE + $08
F01:0063       IDE_LBAH	= IDE0_BASE + $0A
F01:0064       
F00:0002       
F00:0003       org ROM_BASE
F00:0004       
F00:0005       .include "vector.asm"
F02:0001       ;-----------------------------------------------------------------------------
F02:0002       ;exception vector table
F02:0003       dc.l STACK_INIT                 ;Reset Initial Interrupt Stack Pointer
               S01:00000000:  10 10 00 00
F02:0004       dc.l Main                       ;Reset Initial Program Counter
               S01:00000004:  00 00 11 44
F02:0005       dc.l FatalError                 ;Bus error
               S01:00000008:  00 00 04 00
F02:0006       dc.l FatalError                 ;Address error
               S01:0000000C:  00 00 04 00
F02:0007       
F02:0008       dc.l FatalError                 ;Illigal Instruction
               S01:00000010:  00 00 04 00
F02:0009       dc.l FatalError                 ;Zero Divide
               S01:00000014:  00 00 04 00
F02:0010       dc.l FatalError                 ;CHK, CHK2 Instruction
               S01:00000018:  00 00 04 00
F02:0011       dc.l FatalError                 ;cpTRAPcc, TRAPcc, TRAPV Instructions
               S01:0000001C:  00 00 04 00
F02:0012       
F02:0013       dc.l FatalError                 ;Privilege Violation
               S01:00000020:  00 00 04 00
F02:0014       dc.l IgnoreInterrupt            ;Trace
               S01:00000024:  00 00 04 08
F02:0015       dc.l IgnoreInterrupt            ;Line 1010 Emulator
               S01:00000028:  00 00 04 08
F02:0016       dc.l IgnoreInterrupt            ;Line 1111 Emulator
               S01:0000002C:  00 00 04 08
F02:0017       
F02:0018       dc.l IgnoreInterrupt            ;(Reserved)
               S01:00000030:  00 00 04 08
F02:0019       dc.l FatalError                 ;Coprocessor Protocol Violation
               S01:00000034:  00 00 04 00
F02:0020       dc.l FatalError                 ;Format error
               S01:00000038:  00 00 04 00
F02:0021       dc.l FatalError                 ;Uninitialized Interrupt
               S01:0000003C:  00 00 04 00
F02:0022       
F02:0023       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:00000040:  00 00 04 08
F02:0024       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:00000044:  00 00 04 08
F02:0025       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:00000048:  00 00 04 08
F02:0026       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:0000004C:  00 00 04 08
F02:0027       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:00000050:  00 00 04 08
F02:0028       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:00000054:  00 00 04 08
F02:0029       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:00000058:  00 00 04 08
F02:0030       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:0000005C:  00 00 04 08
F02:0031       
F02:0032       dc.l IgnoreInterrupt            ;Spurious Interrupt
               S01:00000060:  00 00 04 08
F02:0033       dc.l IgnoreInterrupt            ;Level 1 Interrupt Autovector
               S01:00000064:  00 00 04 08
F02:0034       dc.l IgnoreInterrupt            ;Level 2 Interrupt Autovector
               S01:00000068:  00 00 04 08
F02:0035       dc.l IgnoreInterrupt            ;Level 3 Interrupt Autovector
               S01:0000006C:  00 00 04 08
F02:0036       
F02:0037       dc.l IgnoreInterrupt            ;Level 4 Interrupt Autovector
               S01:00000070:  00 00 04 08
F02:0038       dc.l IgnoreInterrupt            ;Level 5 Interrupt Autovector
               S01:00000074:  00 00 04 08
F02:0039       dc.l IgnoreInterrupt            ;Level 6 Interrupt Autovector
               S01:00000078:  00 00 04 08
F02:0040       dc.l IgnoreInterrupt            ;Level 7 Interrupt Autovector
               S01:0000007C:  00 00 04 08
F02:0041       
F02:0042       dc.l IgnoreInterrupt            ;TRAP #0
               S01:00000080:  00 00 04 08
F02:0043       dc.l IgnoreInterrupt            ;TRAP #1
               S01:00000084:  00 00 04 08
F02:0044       dc.l IgnoreInterrupt            ;TRAP #2
               S01:00000088:  00 00 04 08
F02:0045       dc.l IgnoreInterrupt            ;TRAP #3
               S01:0000008C:  00 00 04 08
F02:0046       dc.l IgnoreInterrupt            ;TRAP #4
               S01:00000090:  00 00 04 08
F02:0047       dc.l IgnoreInterrupt            ;TRAP #5
               S01:00000094:  00 00 04 08
F02:0048       dc.l IgnoreInterrupt            ;TRAP #6
               S01:00000098:  00 00 04 08
F02:0049       dc.l IgnoreInterrupt            ;TRAP #7
               S01:0000009C:  00 00 04 08
F02:0050       dc.l IgnoreInterrupt            ;TRAP #8
               S01:000000A0:  00 00 04 08
F02:0051       dc.l IgnoreInterrupt            ;TRAP #9
               S01:000000A4:  00 00 04 08
F02:0052       dc.l IgnoreInterrupt            ;TRAP #10
               S01:000000A8:  00 00 04 08
F02:0053       dc.l IgnoreInterrupt            ;TRAP #11
               S01:000000AC:  00 00 04 08
F02:0054       dc.l IgnoreInterrupt            ;TRAP #12
               S01:000000B0:  00 00 04 08
F02:0055       dc.l IgnoreInterrupt            ;TRAP #13
               S01:000000B4:  00 00 04 08
F02:0056       dc.l IgnoreInterrupt            ;TRAP #14
               S01:000000B8:  00 00 04 08
F02:0057       dc.l IgnoreInterrupt            ;TRAP #15
               S01:000000BC:  00 00 04 08
F02:0058       
F02:0059       dc.l IgnoreInterrupt            ;FPCP Branch or Set on Unordered Condition
               S01:000000C0:  00 00 04 08
F02:0060       dc.l IgnoreInterrupt            ;FPCP Inexact Result
               S01:000000C4:  00 00 04 08
F02:0061       dc.l IgnoreInterrupt            ;FPCP Divide by Zero
               S01:000000C8:  00 00 04 08
F02:0062       dc.l IgnoreInterrupt            ;FPCP Underflow
               S01:000000CC:  00 00 04 08
F02:0063       
F02:0064       dc.l IgnoreInterrupt            ;FPCP Operand error
               S01:000000D0:  00 00 04 08
F02:0065       dc.l IgnoreInterrupt            ;FPCP Overflow
               S01:000000D4:  00 00 04 08
F02:0066       dc.l IgnoreInterrupt            ;FPCP Signaling NAN
               S01:000000D8:  00 00 04 08
F02:0067       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:000000DC:  00 00 04 08
F02:0068       
F02:0069       dc.l IgnoreInterrupt            ;PMMU Configuration
               S01:000000E0:  00 00 04 08
F02:0070       dc.l IgnoreInterrupt            ;PMMU Illigal Operation
               S01:000000E4:  00 00 04 08
F02:0071       dc.l IgnoreInterrupt            ;PMMU Access Level Violation
               S01:000000E8:  00 00 04 08
F02:0072       
F02:0073       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:000000EC:  00 00 04 08
F02:0074       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:000000F0:  00 00 04 08
F02:0075       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:000000F4:  00 00 04 08
F02:0076       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:000000F8:  00 00 04 08
F02:0077       dc.l IgnoreInterrupt            ;(Unasigned)
               S01:000000FC:  00 00 04 08
F02:0078       
F02:0079       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 0
               S01:00000100:  00 00 04 08
F02:0080       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 1
               S01:00000104:  00 00 04 08
F02:0081       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 2
               S01:00000108:  00 00 04 08
F02:0082       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 3
               S01:0000010C:  00 00 04 08
F02:0083       dc.l IgnoreInterrupt            ;MFP Timer D
               S01:00000110:  00 00 04 08
F02:0084       dc.l IgnoreInterrupt            ;MFP Timer C
               S01:00000114:  00 00 04 08
F02:0085       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 4
               S01:00000118:  00 00 04 08
F02:0086       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 5
               S01:0000011C:  00 00 04 08
F02:0087       dc.l IgnoreInterrupt            ;MFP Timer B
               S01:00000120:  00 00 04 08
F02:0088       dc.l IgnoreInterrupt            ;MFP Transmit Error
               S01:00000124:  00 00 04 08
F02:0089       dc.l IgnoreInterrupt            ;MFP Transmit Buffer Empty
               S01:00000128:  00 00 04 08
F02:0090       dc.l IgnoreInterrupt            ;MFP Receive Error
               S01:0000012C:  00 00 04 08
F02:0091       dc.l SerialRXHandler            ;MFP Receive Buffer Full
               S01:00000130:  00 00 05 76
F02:0092       dc.l IgnoreInterrupt            ;MFP Timer A
               S01:00000134:  00 00 04 08
F02:0093       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 6
               S01:00000138:  00 00 04 08
F02:0094       dc.l IgnoreInterrupt            ;MFP General Purpose Interrupt 7
               S01:0000013C:  00 00 04 08
F02:0095       
F02:0096       dcb.l 176, IgnoreInterrupt      ;User defined Interrupts
F02:0097       ;-----------------------------------------------------------------------------
F02:0098       ;Basic exception handling function
F02:0099       FatalError:			;locks up cpu completely until reset
F02:0100       		move.w IDE0_BASE, D0
               S01:00000400:  30 39 20 00 00 00
F02:0101       		bra FatalError
               S01:00000406:  60 F8
F02:0102       
F02:0103       IgnoreInterrupt:		;just returns without doing anything
F02:0104               rte
               S01:00000408:  4E 73
F02:0105       
F00:0006       .include "serial.asm"
F03:0001       ;initializes serial interface and timer D for 9600 baud
F03:0002       SerialInit:
F03:0003       		andi.b #$f0, MFP_TCDCR
               S01:0000040A:  02 39 00 F0 40 00 00 0E
F03:0004       		ori.b #$01, MFP_TCDCR
               S01:00000412:  00 39 00 01 40 00 00 0E
F03:0005       		move.b #$3, MFP_TDDR ;TDO clock divider for 9600 baud serial
               S01:0000041A:  13 FC 00 03 40 00 00 12
F03:0006       		;move.b #$04, MFP_TDDR ;TDO clock divider for 115200 baus
F03:0007       
F03:0008       		move.b #$88, MFP_UCR ;CLK / 16, 8bit char, no parity
               S01:00000422:  13 FC 00 88 40 00 00 14
F03:0009       		move.b #$04, MFP_TSR ;set h flag
               S01:0000042A:  13 FC 00 04 40 00 00 16
F03:0010       		move.b #$05, MFP_TSR ;enable transmitter
               S01:00000432:  13 FC 00 05 40 00 00 16
F03:0011       
F03:0012       		move.b #$01, MFP_RSR ;enable receiver
               S01:0000043A:  13 FC 00 01 40 00 00 15
F03:0013       
F03:0014       		move.b #$40, MFP_VR ;MFP interrupt vector base at $40, Automatic end of interrupt mode
               S01:00000442:  13 FC 00 40 40 00 00 0B
F03:0015       		bset.b #4, MFP_IERA ;enable receive buffer full interrupt
               S01:0000044A:  08 F9 00 04 40 00 00 03
F03:0016       		bset.b #4, MFP_IMRA ;unmask receive buffer full interrupt
               S01:00000452:  08 F9 00 04 40 00 00 09
F03:0017       
F03:0018       		rts
               S01:0000045A:  4E 75
F03:0019       
F03:0020       ;writes string to serial
F03:0021       SerialWrite: ;void (char* string)
F03:0022       		move.l (4, A7), A0
               S01:0000045C:  20 6F 00 04
F03:0023       	.loop:
F03:0024       		btst.b #7, MFP_TSR
               S01:00000460:  08 39 00 07 40 00 00 16
F03:0025       		beq.w .loop ;as long as the BE flag is clear loop
               S01:00000468:  67 00 FF F6
F03:0026       
F03:0027       		cmpi.b #$00, (A0) 
               S01:0000046C:  4A 10
F03:0028       		beq.w .return
               S01:0000046E:  67 00 00 0C
F03:0029       		move.b (A0)+, MFP_UDR
               S01:00000472:  13 D8 40 00 00 17
F03:0030       		bra.w .loop
               S01:00000478:  60 00 FF E6
F03:0031       	.return:
F03:0032       		rts
               S01:0000047C:  4E 75
F03:0033       
F03:0034       ;writes char to serial
F03:0035       SerialWriteChar: ;void (int char)
F03:0036       		btst #7, MFP_TSR
               S01:0000047E:  08 39 00 07 40 00 00 16
F03:0037       		beq.w SerialWriteChar
               S01:00000486:  67 00 FF F6
F03:0038       
F03:0039       		move.w (4, A7), D0
               S01:0000048A:  30 2F 00 04
F03:0040       		move.b D0, MFP_UDR
               S01:0000048E:  13 C0 40 00 00 17
F03:0041       		rts
               S01:00000494:  4E 75
F03:0042       
F03:0043       __SerialHexTable:
F03:0044       		dc.b "0123456789ABCDEF"
               S01:00000496:  30 31 32 33 34 35 36 37 38 39 41 42 43 44 45 46
F03:0045       
F03:0046       ;writes 8 bit int to serial as hexadecimal
F03:0047       SerialWriteHex8: ;void (int number)
F03:0048       		move.l #__SerialHexTable, A0
               S01:000004A6:  30 7C 04 96
F03:0049       	.loop0:
F03:0050       		btst.b #7, MFP_TSR
               S01:000004AA:  08 39 00 07 40 00 00 16
F03:0051       		beq.w .loop0
               S01:000004B2:  67 00 FF F6
F03:0052       
F03:0053       		move.w (4, A7), D0
               S01:000004B6:  30 2F 00 04
F03:0054       		andi.w #$00f0, D0
               S01:000004BA:  02 40 00 F0
F03:0055       		lsr.w #4, D0
               S01:000004BE:  E8 48
F03:0056       		move.b (0,A0,D0), MFP_UDR
               S01:000004C0:  13 F0 00 00 40 00 00 17
F03:0057       	.loop1:
F03:0058       		btst.b #7, MFP_TSR
               S01:000004C8:  08 39 00 07 40 00 00 16
F03:0059       		beq.w .loop1
               S01:000004D0:  67 00 FF F6
F03:0060       
F03:0061       		move.w (4, A7), D0
               S01:000004D4:  30 2F 00 04
F03:0062       		andi.w #$000f, D0
               S01:000004D8:  02 40 00 0F
F03:0063       		move.b (0,A0,D0), MFP_UDR
               S01:000004DC:  13 F0 00 00 40 00 00 17
F03:0064       
F03:0065       		rts
               S01:000004E4:  4E 75
F03:0066       
F03:0067       ;writes 16 bit int to serial as hexadecimal
F03:0068       SerialWriteHex16: ;void (int number)
F03:0069       		move.w (4, A7), D0
               S01:000004E6:  30 2F 00 04
F03:0070       		andi.w #$ff00, D0
               S01:000004EA:  02 40 FF 00
F03:0071       		lsr.w #8, D0
               S01:000004EE:  E0 48
F03:0072       		move.w D0, -(A7)
               S01:000004F0:  3F 00
F03:0073       		bsr.w SerialWriteHex8
               S01:000004F2:  61 00 FF B2
F03:0074       		addq.l #2, A7
               S01:000004F6:  54 8F
F03:0075       
F03:0076       		move.w (4, A7), D0
               S01:000004F8:  30 2F 00 04
F03:0077       		andi.w #$00ff, D0
               S01:000004FC:  02 40 00 FF
F03:0078       		move.w D0, -(A7)
               S01:00000500:  3F 00
F03:0079       		bsr.w SerialWriteHex8
               S01:00000502:  61 00 FF A2
F03:0080       		addq.l #2, A7
               S01:00000506:  54 8F
F03:0081       
F03:0082       		rts
               S01:00000508:  4E 75
F03:0083       
F03:0084       ;writes 32 bit int to serial as hexadecimal
F03:0085       SerialWriteHex32: ;void (long number)
F03:0086       		move.w (6, A7), D0
               S01:0000050A:  30 2F 00 06
F03:0087       		move.w D0, -(A7)
               S01:0000050E:  3F 00
F03:0088       		bsr.w SerialWriteHex16
               S01:00000510:  61 00 FF D4
F03:0089       		addq.l #2, A7
               S01:00000514:  54 8F
F03:0090       
F03:0091       		move.w (4, A7), D0
               S01:00000516:  30 2F 00 04
F03:0092       		move.w D0, -(A7)
               S01:0000051A:  3F 00
F03:0093       		bsr.w SerialWriteHex16
               S01:0000051C:  61 00 FF C8
F03:0094       		addq.l #2, A7
               S01:00000520:  54 8F
F03:0095       
F03:0096       		rts
               S01:00000522:  4E 75
F03:0097       
F03:0098       ;writes 32 bit int to serial as decimal
F03:0099       SerialWriteDec32: ;void (long number)
F03:0100       		move.l (4, A7), D0
               S01:00000524:  20 2F 00 04
F03:0101       		move.l D2, -(A7)
               S01:00000528:  2F 02
F03:0102       		clr.l D2
               S01:0000052A:  74 00
F03:0103       		clr.l D1
               S01:0000052C:  72 00
F03:0104       
F03:0105       	.divLoop:
F03:0106       		cmpi.l #0, D0
               S01:0000052E:  4A 80
F03:0107       		beq .display
               S01:00000530:  67 0E
F03:0108       		divul.l #10, D1:D0
               S01:00000532:  4C 7C 00 01 00 00 00 0A
F03:0109       		move.w D1, -(A7)
               S01:0000053A:  3F 01
F03:0110       		addq.w #1, D2
               S01:0000053C:  52 42
F03:0111       		bra .divLoop
               S01:0000053E:  60 EE
F03:0112       
F03:0113       	.display:
F03:0114       		cmpi.w #0, D2
               S01:00000540:  4A 42
F03:0115       		beq .return
               S01:00000542:  67 1E
F03:0116       		move.w (A7)+, D0
               S01:00000544:  30 1F
F03:0117       		addi.b #'0', D0
               S01:00000546:  06 00 00 30
F03:0118       	.waitMfp:
F03:0119       		btst.b #7, MFP_TSR
               S01:0000054A:  08 39 00 07 40 00 00 16
F03:0120               beq.w .waitMfp
               S01:00000552:  67 00 FF F6
F03:0121       		move.b D0, MFP_UDR
               S01:00000556:  13 C0 40 00 00 17
F03:0122       		subq #1, D2
               S01:0000055C:  53 42
F03:0123       		bra.w .display
               S01:0000055E:  60 00 FF E0
F03:0124       
F03:0125       	.return:
F03:0126       		move.l (A7)+, D2
               S01:00000562:  24 1F
F03:0127       		rts
               S01:00000564:  4E 75
F03:0128       
F03:0129       ;writes 16 bit int to serial as decimal
F03:0130       SerialWriteDec16: ;void (int number)
F03:0131       		clr.l D0
               S01:00000566:  70 00
F03:0132       		move.w (4, A7), D0
               S01:00000568:  30 2F 00 04
F03:0133       		move.l D0, -(A7)
               S01:0000056C:  2F 00
F03:0134       		bsr.w SerialWriteDec32
               S01:0000056E:  61 00 FF B4
F03:0135       		addq.l #4, A7
               S01:00000572:  58 8F
F03:0136       		rts
               S01:00000574:  4E 75
F03:0137       
F03:0138       ;interrupt handler for serial receiver
F03:0139       SerialRXHandler: ;void ()
F03:0140       
F03:0141       		move.l D0, -(A7)
               S01:00000576:  2F 00
F03:0142       		move.l D1, -(A7)
               S01:00000578:  2F 01
F03:0143       		move.l A0, -(A7)
               S01:0000057A:  2F 08
F03:0144       
F03:0145       		move.l #__SerialRingbuffer, A0
               S01:0000057C:  20 7C 10 00 00 00
F03:0146       		move.w __SerialRBWrite, D0
               S01:00000582:  30 39 10 00 02 02
F03:0147       		move.b MFP_UDR, D1
               S01:00000588:  12 39 40 00 00 17
F03:0148       		andi.w #$00ff, D1
               S01:0000058E:  02 41 00 FF
F03:0149       		move.w D1, (0, A0, D0.w*2)
               S01:00000592:  31 81 02 00
F03:0150       		addq.w #1, D0
               S01:00000596:  52 40
F03:0151       		andi.w #$00ff, D0
               S01:00000598:  02 40 00 FF
F03:0152       		move.w D0, __SerialRBWrite
               S01:0000059C:  33 C0 10 00 02 02
F03:0153       
F03:0154       		move.l (A7)+, A0
               S01:000005A2:  20 5F
F03:0155       		move.l (A7)+, D1
               S01:000005A4:  22 1F
F03:0156       		move.l (A7)+, D0
               S01:000005A6:  20 1F
F03:0157       		rte
               S01:000005A8:  4E 73
F03:0158       
F03:0159       ;returns the number of characters to read from the ringbuffer
F03:0160       SerialAvailable: ;int ()
F03:0161       		move.w __SerialRBWrite, D0
               S01:000005AA:  30 39 10 00 02 02
F03:0162       		move.w __SerialRBRead, D1
               S01:000005B0:  32 39 10 00 02 00
F03:0163       		sub.w D1, D0
               S01:000005B6:  90 41
F03:0164       		andi.w #$00ff, D0
               S01:000005B8:  02 40 00 FF
F03:0165       		rts
               S01:000005BC:  4E 75
F03:0166       
F03:0167       ;read a character from the ringbuffer, returns zero if buffer empty
F03:0168       SerialRead: ;int ()
F03:0169       		bsr SerialAvailable
               S01:000005BE:  61 EA
F03:0170       		cmp.w #0, D0
               S01:000005C0:  4A 40
F03:0171       		beq .return ;no data in the buffer, return
               S01:000005C2:  67 1C
F03:0172       
F03:0173       		move.w __SerialRBRead, D1
               S01:000005C4:  32 39 10 00 02 00
F03:0174       		move.l __SerialRingbuffer, A0
               S01:000005CA:  20 79 10 00 00 00
F03:0175       		move.w (0, A0, D1.w*2), D0
               S01:000005D0:  30 30 12 00
F03:0176       		addq.w #1, D1
               S01:000005D4:  52 41
F03:0177       		andi.w #$00ff, D1
               S01:000005D6:  02 41 00 FF
F03:0178       		move.w D1	, __SerialRBRead
               S01:000005DA:  33 C1 10 00 02 00
F03:0179       
F03:0180       	.return:
F03:0181       		rts
               S01:000005E0:  4E 75
F03:0182       
F03:0183       SerialHexdump: ;void (char*, int length)
F03:0184       		move.w (4, A7), D0
               S01:000005E2:  30 2F 00 04
F03:0185       		move.l (6, A7), A0
               S01:000005E6:  20 6F 00 06
F03:0186       
F03:0187       		clr.l D1 ;counter
               S01:000005EA:  72 00
F03:0188       		move.l D2, -(A7)
               S01:000005EC:  2F 02
F03:0189       	.lineLoop:
F03:0190       		cmp.w D0, D1
               S01:000005EE:  B2 40
F03:0191       		beq.w .exit
               S01:000005F0:  67 00 00 6A
F03:0192       
F03:0193       		move.l D0, -(A7)
               S01:000005F4:  2F 00
F03:0194       		move.l D1, -(A7)
               S01:000005F6:  2F 01
F03:0195       		move.l A0, -(A7)
               S01:000005F8:  2F 08
F03:0196       
F03:0197       		move.l #.text+1, -(A7)
               S01:000005FA:  2F 3C 00 00 06 61
F03:0198       		bsr SerialWrite
               S01:00000600:  61 00 FE 5A
F03:0199       		addq.l #4, A7
               S01:00000604:  58 8F
F03:0200       		move.l (A7), A0
               S01:00000606:  20 57
F03:0201       
F03:0202       		;lea.l (A0, D1), -(A7)
F03:0203       		move.l A0, -(A7)
               S01:00000608:  2F 08
F03:0204       		add.l D1, (A7)
               S01:0000060A:  D3 97
F03:0205       
F03:0206       		bsr SerialWriteHex32
               S01:0000060C:  61 00 FE FC
F03:0207       		addq.l #4, A7
               S01:00000610:  58 8F
F03:0208       
F03:0209       		move.w ':', -(A7)
               S01:00000612:  3F 38 00 3A
F03:0210                       bsr SerialWriteChar
               S01:00000616:  61 00 FE 66
F03:0211                       addq.l #2, A7
               S01:0000061A:  54 8F
F03:0212       
F03:0213       		move.l (A7)+, A0
               S01:0000061C:  20 5F
F03:0214       		move.l (A7)+, D1
               S01:0000061E:  22 1F
F03:0215       		move.l (A7)+, D0
               S01:00000620:  20 1F
F03:0216       
F03:0217       		clr.l D2 ;line counter
               S01:00000622:  74 00
F03:0218       	.outLoop:
F03:0219       		cmp.w D0, D1
               S01:00000624:  B2 40
F03:0220       		beq.w .exit
               S01:00000626:  67 00 00 34
F03:0221       		move.l A0, -(A7)
               S01:0000062A:  2F 08
F03:0222       		move.l #.text, -(A7)
               S01:0000062C:  2F 3C 00 00 06 60
F03:0223       		bsr SerialWrite
               S01:00000632:  61 00 FE 28
F03:0224       		addq.l #4, A7
               S01:00000636:  58 8F
F03:0225       		move.l (A7)+, A0
               S01:00000638:  20 5F
F03:0226       
F03:0227       		move.l D2, -(A7)
               S01:0000063A:  2F 02
F03:0228       		clr.w D2
               S01:0000063C:  42 42
F03:0229       		move.b (A0, D1), D2
               S01:0000063E:  14 30 10 00
F03:0230       		move.w D2, -(A7)
               S01:00000642:  3F 02
F03:0231       		bsr SerialWriteHex8
               S01:00000644:  61 00 FE 60
F03:0232       		addq.l #2, A7
               S01:00000648:  54 8F
F03:0233       		move.l (A7)+, D2
               S01:0000064A:  24 1F
F03:0234       
F03:0235       		addq.w #1, D1
               S01:0000064C:  52 41
F03:0236       		addq.w #1, D2
               S01:0000064E:  52 42
F03:0237       
F03:0238       		cmpi.w #$00f0, D2
               S01:00000650:  0C 42 00 F0
F03:0239       		bne.w .outLoop
               S01:00000654:  66 00 FF CE
F03:0240       
F03:0241       		bra.w .lineLoop
               S01:00000658:  60 00 FF 94
F03:0242       	.exit:
F03:0243       		move.l (A7)+, D2
               S01:0000065C:  24 1F
F03:0244       		rts
               S01:0000065E:  4E 75
F03:0245       	.text:
F03:0246       		dc.b " 0x", $00
               S01:00000660:  20 30 78
               S01:00000663:  00
F03:0247       
F03:0248       
F03:0249       
F00:0007       .include "ide.asm"
F04:0001       IdeInit:
F04:0002       		rts
               S01:00000664:  4E 75
F04:0003       
F00:0008       .include "updater.asm"
F05:0001       UpdaterInit:
F05:0002               move.l #.text0, -(A7)
               S01:00000666:  2F 3C 00 00 06 98
F05:0003               bsr SerialWrite
               S01:0000066C:  61 00 FD EE
F05:0004               addq.l #4, A7
               S01:00000670:  58 8F
F05:0005               move.l #.payload_start, A0
               S01:00000672:  30 7C 06 C2
F05:0006               move.l #RAM_BASE, A1
               S01:00000676:  22 7C 10 00 00 00
F05:0007           .loop:
F05:0008               move.l (A0)+, (A1)+
               S01:0000067C:  22 D8
F05:0009               cmpa.l #.payload_end, A0
               S01:0000067E:  B0 FC 0A 9E
F05:0010               bls.w .loop
               S01:00000682:  63 00 FF F8
F05:0011       
F05:0012               move.l #.text1, -(A7)
               S01:00000686:  2F 3C 00 00 06 B0
F05:0013               bsr SerialWrite
               S01:0000068C:  61 00 FD CE
F05:0014               addq.l #4, A7
               S01:00000690:  58 8F
F05:0015       
F05:0016               jmp RAM_BASE
               S01:00000692:  4E F9 10 00 00 00
F05:0017       
F05:0018           .text0:
F05:0019               dc.b "loading payload to RAM\n", $00
               S01:00000698:  6C 6F 61 64 69 6E 67 20 70 61 79 6C 6F 61 64 20
               S01:000006A8:  74 6F 20 52 41 4D 0A
               S01:000006AF:  00
F05:0020           .text1:
F05:0021               dc.b "calling payload\n", $00
               S01:000006B0:  63 61 6C 6C 69 6E 67 20 70 61 79 6C 6F 61 64 0A
               S01:000006C0:  00
F05:0022       
F05:0023               even
F05:0024           .payload_start:
F05:0025               .incbin "../build/updaterPayload.bin"
               S01:000006C2:  61 00 01 7A 41 FA 01 58 2F 08 61 00 01 AA 58 4F
               S01:000006D2:  70 00 61 00 01 DC 3F 00 61 00 01 BE 30 1F 0C 00
F05:0026           .payload_end:
F00:0009       .include "compostfetch.asm"
F06:0001       CompostFetch:
F06:0002               dc.b "\n\n"
               S01:00000A9E:  0A 0A
F06:0003       		dc.b "\e[32m", "c.                                    .:   root", "\e[97m", "@", "\e[32m", "compostbin\n"
               S01:00000AA0:  1B 5B 33 32 6D
               S01:00000AA5:  63 2E 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:00000AB5:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:00000AC5:  1B 5B 39 37 6D
               S01:00000ACA:  40
               S01:00000ACB:  1B 5B 33 32 6D
               S01:00000AD0:  63 6F 6D 70 6F 73 74 62 69 6E 0A
F06:0004       		dc.b "\e[32m", "00l.                                .;kK   ", "\e[97m", "---------------\n"
               S01:00000AEA:  1B 5B 33 32 6D
               S01:00000AEF:  30 30 6C 2E 20 20 20 20 20 20 20 20 20 20 20 20
               S01:00000AFF:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:00000B0F:  1B 5B 39 37 6D
               S01:00000B14:  2D 2D 2D 2D 2D 2D 2D 2D 2D 2D 2D 2D 2D 2D 2D 0A
F06:0005       		dc.b "\e[32m", "xNWXd,                            .:ONWO   OS: ", "\e[97m", "Comp!_OSt 1.00Alpha m68k_020\n"
               S01:00000B2F:  1B 5B 33 32 6D
               S01:00000B34:  78 4E 57 58 64 2C 20 20 20 20 20 20 20 20 20 20
               S01:00000B44:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:00000B54:  1B 5B 39 37 6D
               S01:00000B59:  43 6F 6D 70 21 5F 4F 53 74 20 31 2E 30 30 41 6C
               S01:00000B69:  70 68 61 20 6D 36 38 6B 5F 30 32 30 0A
F06:0006       		dc.b "\e[32m", "':dXWNk:.                       .l0WNOc,   Host: ", "\e[97m", "Computronics MEGASYSTEM 020\n"
               S01:00000B85:  1B 5B 33 32 6D
               S01:00000B8A:  27 3A 64 58 57 4E 6B 3A 2E 20 20 20 20 20 20 20
               S01:00000B9A:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:00000BAA:  1B 5B 39 37 6D
               S01:00000BAF:  43 6F 6D 70 75 74 72 6F 6E 69 63 73 20 4D 45 47
               S01:00000BBF:  41 53 59 53 54 45 4D 20 30 32 30 0A
F06:0007       		dc.b "\e[32m", "Ok:;l0WW0o'                   'oKWNx:;d0   Kernel: ", "\e[97m", "0.00.3-00-beedroot\n"
               S01:00000BDC:  1B 5B 33 32 6D
               S01:00000BE1:  4F 6B 3A 3B 6C 30 57 57 30 6F 27 20 20 20 20 20
               S01:00000BF1:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 27 6F
               S01:00000C01:  1B 5B 39 37 6D
               S01:00000C06:  30 2E 30 30 2E 33 2D 30 30 2D 62 65 65 64 72 6F
               S01:00000C16:  6F 74 0A
F06:0008       		dc.b "\e[32m", "OWW0l;ckNWXx;.              ,dXWXd::dXWK   Uptime: ", "\e[97m", "NaN\n"
               S01:00000C2C:  1B 5B 33 32 6D
               S01:00000C31:  4F 57 57 30 6C 3B 63 6B 4E 57 58 78 3B 2E 20 20
               S01:00000C41:  20 20 20 20 20 20 20 20 20 20 20 20 2C 64 58 57
               S01:00000C51:  1B 5B 39 37 6D
               S01:00000C56:  4E 61 4E 0A
F06:0009       		dc.b "\e[32m", "'cONWKd:;dKWNOc.          ;xNWKo;:kNWKo,   Packages: ", "\e[97m", "0\n"
               S01:00000C6D:  1B 5B 33 32 6D
               S01:00000C72:  27 63 4F 4E 57 4B 64 3A 3B 64 4B 57 4E 4F 63 2E
               S01:00000C82:  20 20 20 20 20 20 20 20 20 20 3B 78 4E 57 4B 6F
               S01:00000C92:  1B 5B 39 37 6D
               S01:00000C97:  30 0A
F06:0010       		dc.b "\e[32m", "xo;:xXWNkc;lOWWKo'     .:kNW0l;cONW0l;cx   Shell: ", "\e[97m", "comp!_OSt shell 0.0.1\n"
               S01:00000CAE:  1B 5B 33 32 6D
               S01:00000CB3:  78 6F 3B 3A 78 58 57 4E 6B 63 3B 6C 4F 57 57 4B
               S01:00000CC3:  6F 27 20 20 20 20 20 2E 3A 6B 4E 57 30 6C 3B 63
               S01:00000CD3:  1B 5B 39 37 6D
               S01:00000CD8:  63 6F 6D 70 21 5F 4F 53 74 20 73 68 65 6C 6C 20
               S01:00000CE8:  30 2E 30 2E 31 0A
F06:0011       		dc.b "\e[32m", "0WXx:;o0WW0o;:xXWXx;..cOWWOc;l0WNOc;l0WX   Resolution: ", "\e[97m", "NaN\n"
               S01:00000D00:  1B 5B 33 32 6D
               S01:00000D05:  30 57 58 78 3A 3B 6F 30 57 57 30 6F 3B 3A 78 58
               S01:00000D15:  57 58 78 3B 2E 2E 63 4F 57 57 4F 63 3B 6C 30 57
               S01:00000D25:  1B 5B 39 37 6D
               S01:00000D2A:  4E 61 4E 0A
F06:0012       		dc.b "\e[32m", ",oKWNOl;ckNWXd:;oKWXkONNkc;oKWNk:;oKWNx;   DE: ", "\e[97m", "tty\n"
               S01:00000D45:  1B 5B 33 32 6D
               S01:00000D4A:  2C 6F 4B 57 4E 4F 6C 3B 63 6B 4E 57 58 64 3A 3B
               S01:00000D5A:  6F 4B 57 58 6B 4F 4E 4E 6B 63 3B 6F 4B 57 4E 6B
               S01:00000D6A:  1B 5B 39 37 6D
               S01:00000D6F:  74 74 79 0A
F06:0013       		dc.b "\e[32m", "oc;cONWKo;:dKWNkc;cddxd:;dKWXx::dXWXd;:o   WM: ", "\e[97m", "NaN\n"
               S01:00000D82:  1B 5B 33 32 6D
               S01:00000D87:  6F 63 3B 63 4F 4E 57 4B 6F 3B 3A 64 4B 57 4E 6B
               S01:00000D97:  63 3B 63 64 64 78 64 3A 3B 64 4B 57 58 78 3A 3A
               S01:00000DA7:  1B 5B 39 37 6D
               S01:00000DAC:  4E 61 4E 0A
F06:0014       		dc.b "\e[32m", "KW0o;:xXWXk:;l0WW0o,.';xXWKd;:xXWKo;:kNN   Terminal: ", "\e[97m", "MC68901P\n"
               S01:00000DBF:  1B 5B 33 32 6D
               S01:00000DC4:  4B 57 30 6F 3B 3A 78 58 57 58 6B 3A 3B 6C 30 57
               S01:00000DD4:  57 30 6F 2C 2E 27 3B 78 58 57 4B 64 3B 3A 78 58
               S01:00000DE4:  1B 5B 39 37 6D
               S01:00000DE9:  4D 43 36 38 39 30 31 50 0A
F06:0015       		dc.b "\e[32m", ";kNWXx:;o0WW0l;ckNWKxkXW0o;ckNW0l;cONW0c   CPU: ", "\e[97m", "Motorola MC68020RC16B (1) @ 16.00Mhz\n" 
               S01:00000E07:  1B 5B 33 32 6D
               S01:00000E0C:  3B 6B 4E 57 58 78 3A 3B 6F 30 57 57 30 6C 3B 63
               S01:00000E1C:  6B 4E 57 4B 78 6B 58 57 30 6F 3B 63 6B 4E 57 30
               S01:00000E2C:  1B 5B 39 37 6D
               S01:00000E31:  4D 6F 74 6F 72 6F 6C 61 20 4D 43 36 38 30 32 30
               S01:00000E41:  52 43 31 36 42 20 28 31 29 20 40 20 31 36 2E 30
F06:0016       		dc.b "\e[32m", "  ,dKWNOc;ckNWKd:;dkkOkl;lOWWOc;l0WNO:.    GPU: ", "\e[97m", "NaN\n"
               S01:00000E66:  1B 5B 33 32 6D
               S01:00000E6B:  20 20 2C 64 4B 57 4E 4F 63 3B 63 6B 4E 57 4B 64
               S01:00000E7B:  3A 3B 64 6B 6B 4F 6B 6C 3B 6C 4F 57 57 4F 63 3B
               S01:00000E8B:  1B 5B 39 37 6D
               S01:00000E90:  4E 61 4E 0A
F06:0017       		dc.b "\e[32m", "    .cOWWKo;:dXWNkc,.',o0WNk:;oKWNx;.      Memory: ", "\e[97m", "156KiB / 1024 KiB\n"
               S01:00000EA4:  1B 5B 33 32 6D
               S01:00000EA9:  20 20 20 20 2E 63 4F 57 57 4B 6F 3B 3A 64 58 57
               S01:00000EB9:  4E 6B 63 2C 2E 27 2C 6F 30 57 4E 6B 3A 3B 6F 4B
               S01:00000EC9:  1B 5B 39 37 6D
               S01:00000ECE:  31 35 36 4B 69 42 20 2F 20 31 30 32 34 20 4B 69
               S01:00000EDE:  42 0A
F06:0018       		dc.b "\e[32m", "      .;xXWXx:;l0WWOodKWXx:;dXWXd,         \n"
               S01:00000EF3:  1B 5B 33 32 6D
               S01:00000EF8:  20 20 20 20 20 20 2E 3B 78 58 57 58 78 3A 3B 6C
               S01:00000F08:  30 57 57 4F 6F 64 4B 57 58 78 3A 3B 64 58 57 58
F06:0019       		dc.b "\e[32m", "         'oKWNOl;ck0000d;:xXWKo'           \e[30mâ–ˆâ–ˆâ–ˆ\e[31mâ–ˆâ–ˆâ–ˆ\e[32mâ–ˆâ–ˆâ–ˆ\e[33mâ–ˆâ–ˆâ–
               S01:00000F24:  1B 5B 33 32 6D
               S01:00000F29:  20 20 20 20 20 20 20 20 20 27 6F 4B 57 4E 4F 6C
               S01:00000F39:  3B 63 6B 30 30 30 30 64 3B 3A 78 58 57 4B 6F 27
F06:0020       		dc.b "\e[32m", "           .cONWKd;,,,,ckNW0l.             \e[90mâ–ˆâ–ˆâ–ˆ\e[91mâ–ˆâ–ˆâ–ˆ\e[92mâ–ˆâ–ˆâ–ˆ\e[93mâ–ˆâ–ˆâ–
               S01:00000FC5:  1B 5B 33 32 6D
               S01:00000FCA:  20 20 20 20 20 20 20 20 20 20 20 2E 63 4F 4E 57
               S01:00000FDA:  4B 64 3B 2C 2C 2C 2C 63 6B 4E 57 30 6C 2E 20 20
F06:0021       		dc.b "\e[32m", "             .;xXWNxclOWWOc.               \n"
               S01:00001066:  1B 5B 33 32 6D
               S01:0000106B:  20 20 20 20 20 20 20 20 20 20 20 20 20 2E 3B 78
               S01:0000107B:  58 57 4E 78 63 6C 4F 57 57 4F 63 2E 20 20 20 20
F06:0022       		dc.b "\e[32m", "                'o0K0KXk:.                 \n"
               S01:00001097:  1B 5B 33 32 6D
               S01:0000109C:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:000010AC:  27 6F 30 4B 30 4B 58 6B 3A 2E 20 20 20 20 20 20
F06:0023       		dc.b "\e[32m", "                  'oxxc.                   \n\n"
               S01:000010C8:  1B 5B 33 32 6D
               S01:000010CD:  20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
               S01:000010DD:  20 20 27 6F 78 78 63 2E 20 20 20 20 20 20 20 20
F06:0024       		dc.b "\e[92m", "root@compostbin", "\e[97m", ":", "\e[94m", "~", "\e[97m", "$ ", $00
               S01:000010FA:  1B 5B 39 32 6D
               S01:000010FF:  72 6F 6F 74 40 63 6F 6D 70 6F 73 74 62 69 6E
               S01:0000110E:  1B 5B 39 37 6D
               S01:00001113:  3A
               S01:00001114:  1B 5B 39 34 6D
               S01:00001119:  7E
               S01:0000111A:  1B 5B 39 37 6D
               S01:0000111F:  24 20
               S01:00001121:  00
F06:0025               even
F00:0010       .include "string.asm"
F07:0001       StringCompare: ;int (char* a, char* b)
F07:0002               move.l ($04, A7), A0 ;a
               S01:00001122:  20 6F 00 04
F07:0003               move.l ($08, A7), A1 ;b
               S01:00001126:  22 6F 00 08
F07:0004               clr.w D0
               S01:0000112A:  42 40
F07:0005           .loop:
F07:0006               move.b (A0), D0
               S01:0000112C:  10 10
F07:0007               add.b (A1), D0
               S01:0000112E:  D0 11
F07:0008               cmpi.w #$0000, D0
               S01:00001130:  4A 40
F07:0009               beq .exit
               S01:00001132:  67 0C
F07:0010               cmp.b (A0)+, (A1)+
               S01:00001134:  B3 08
F07:0011               beq .loop
               S01:00001136:  67 F4
F07:0012       
F07:0013               ;string equal up to position in D0 
F07:0014               suba.l ($08, A7), A1
               S01:00001138:  93 EF 00 08
F07:0015               move.l A1, D0
               S01:0000113C:  20 09
F07:0016               rts
               S01:0000113E:  4E 75
F07:0017           
F07:0018               ;strings are equal
F07:0019           .exit:
F07:0020               clr.l D0
               S01:00001140:  70 00
F07:0021               rts
               S01:00001142:  4E 75
F07:0022       
F00:0011       
F00:0012       Main:
F00:0013       		bsr SerialInit
               S01:00001144:  61 00 F2 C4
F00:0014       
F00:0015       		bclr #2, MFP_DDR
               S01:00001148:  08 B9 00 02 40 00 00 02
F00:0016       		btst #2, MFP_GPDR ;test if userinterrupt button is pressed
               S01:00001150:  08 39 00 02 40 00 00 00
F00:0017       		beq UpdaterInit ;if pressed jump to updater
               S01:00001158:  67 00 F5 0C
F00:0018       
F00:0019       		move.l #CompostFetch, -(A7)
               S01:0000115C:  2F 3C 00 00 0A 9E
F00:0020       		bsr SerialWrite
               S01:00001162:  61 00 F2 F8
F00:0021       		addq.l #4, A7
               S01:00001166:  58 8F
F00:0022       
F00:0023       		move.l #.text0, -(A7)
               S01:00001168:  2F 3C 00 00 12 36
F00:0024       		bsr SerialWrite
               S01:0000116E:  61 00 F2 EC
F00:0025       		addq.l #4, A7
               S01:00001172:  58 8F
F00:0026       
F00:0027       		move.l #.text2, -(A7)
               S01:00001174:  2F 3C 00 00 13 74
F00:0028       		bsr SerialWrite
               S01:0000117A:  61 00 F2 E0
F00:0029       		addq.l #4, A7
               S01:0000117E:  58 8F
F00:0030       
F00:0031       		andi.w #$f8ff, SR
               S01:00001180:  02 7C F8 FF
F00:0032       
F00:0033       		bsr getBootblockCount
               S01:00001184:  61 00 02 4C
F00:0034       		move.l D0, D2 ;move bootblock count to trash proof register
               S01:00001188:  24 00
F00:0035       		move.l D0, -(A7)
               S01:0000118A:  2F 00
F00:0036       		bsr SerialWriteDec32
               S01:0000118C:  61 00 F3 96
F00:0037       		addq.l #4, A7
               S01:00001190:  58 8F
F00:0038       
F00:0039       		move.l #__CommandBuffer, A2
               S01:00001192:  24 7C 10 00 02 04
F00:0040       		clr.l D2
               S01:00001198:  74 00
F00:0041       
F00:0042       	.cmdLoop:
F00:0043       		bsr SerialAvailable
               S01:0000119A:  61 00 F4 0E
F00:0044       		cmpi.b #0, D0
               S01:0000119E:  4A 00
F00:0045       		beq .cmdLoop
               S01:000011A0:  67 F8
F00:0046       		bsr SerialRead
               S01:000011A2:  61 00 F4 1A
F00:0047       		move.w D0, -(A7)
               S01:000011A6:  3F 00
F00:0048       		bsr SerialWriteChar
               S01:000011A8:  61 00 F2 D4
F00:0049       		move.w (A7)+, D0
               S01:000011AC:  30 1F
F00:0050       		cmp.w '\n', D0
               S01:000011AE:  B0 78 00 0A
F00:0051       		beq .cmdInterpret
               S01:000011B2:  67 08
F00:0052       		move.w D0, (A2, D2.w*2)
               S01:000011B4:  35 80 22 00
F00:0053       		addq.w #1, D2
               S01:000011B8:  52 42
F00:0054       		bra .cmdLoop
               S01:000011BA:  60 DE
F00:0055       
F00:0056       	.cmdInterpret:
F00:0057       		move.w #0, (A2, D2.w*2) ;add null termination to string
               S01:000011BC:  42 72 22 00
F00:0058       
F00:0059       		move.l #__CommandBuffer, A2
               S01:000011C0:  24 7C 10 00 02 04
F00:0060       		move.l A2, -(A7)
               S01:000011C6:  2F 0A
F00:0061       		move.l #.textCommandTest, -(A7)
               S01:000011C8:  2F 3C 00 00 13 AA
F00:0062       		bsr StringCompare
               S01:000011CE:  61 00 FF 52
F00:0063       		addq.l #8, A7
               S01:000011D2:  50 8F
F00:0064       		cmpi.l #0, D0
               S01:000011D4:  4A 80
F00:0065       		beq .commandTest
               S01:000011D6:  67 2E
F00:0066       
F00:0067       		move.l #__CommandBuffer, A2
               S01:000011D8:  24 7C 10 00 02 04
F00:0068       		move.l A2, -(A7)
               S01:000011DE:  2F 0A
F00:0069       		move.l #.textCommandIntro, -(A7)
               S01:000011E0:  2F 3C 00 00 13 AF
F00:0070       		bsr StringCompare
               S01:000011E6:  61 00 FF 3A
F00:0071       		addq.l #8, A7
               S01:000011EA:  50 8F
F00:0072       		cmpi.l #0, D0
               S01:000011EC:  4A 80
F00:0073       		beq .commandIntro
               S01:000011EE:  67 2E
F00:0074       
F00:0075       		move.l #.textCommandnotfound, -(A7)
               S01:000011F0:  2F 3C 00 00 13 B5
F00:0076       		bsr SerialWrite
               S01:000011F6:  61 00 F2 64
F00:0077       		addq.l #4, A7
               S01:000011FA:  58 8F
F00:0078       		move.l #__CommandBuffer, A2
               S01:000011FC:  24 7C 10 00 02 04
F00:0079       		clr.l D2
               S01:00001202:  74 00
F00:0080       		bsr .cmdLoop
               S01:00001204:  61 94
F00:0081       
F00:0082       	.commandTest:
F00:0083       		move.l #.text1, -(A7)
               S01:00001206:  2F 3C 00 00 13 8E
F00:0084       		bsr SerialWrite
               S01:0000120C:  61 00 F2 4E
F00:0085       		addq.l #4, A7
               S01:00001210:  58 8F
F00:0086       		move.l #__CommandBuffer, A2
               S01:00001212:  24 7C 10 00 02 04
F00:0087       		clr.l D2
               S01:00001218:  74 00
F00:0088       		bsr .cmdLoop
               S01:0000121A:  61 00 FF 7E
F00:0089       
F00:0090       	.commandIntro:
F00:0091       		move.l #.text0, -(A7)
               S01:0000121E:  2F 3C 00 00 12 36
F00:0092       		bsr SerialWrite
               S01:00001224:  61 00 F2 36
F00:0093       		addq.l #4, A7
               S01:00001228:  58 8F
F00:0094       		move.l #__CommandBuffer, A2
               S01:0000122A:  24 7C 10 00 02 04
F00:0095       		clr.l D2
               S01:00001230:  74 00
F00:0096       		bsr .cmdLoop
               S01:00001232:  61 00 FF 66
F00:0097       
F00:0098       
F00:0099       	.text0:
F00:0100       	;ascii text font Doom (www.coolgenerator.com/ascii-text-generator)
F00:0101       		dc.b "\n\n"
               S01:00001236:  0A 0A
F00:0102       		dc.b "\e[91m", "______ _____ _____ _____  _____  _____  _____\n"
               S01:00001238:  1B 5B 39 31 6D
               S01:0000123D:  5F 5F 5F 5F 5F 5F 20 5F 5F 5F 5F 5F 20 5F 5F 5F
               S01:0000124D:  5F 5F 20 5F 5F 5F 5F 5F 20 20 5F 5F 5F 5F 5F 20
F00:0103       		dc.b "\e[92m", "| ___ \\_   _|  _  /  ___||  _  |/ __  \\|  _  |\n"
               S01:0000126B:  1B 5B 39 32 6D
               S01:00001270:  7C 20 5F 5F 5F 20 5C 5F 20 20 20 5F 7C 20 20 5F
               S01:00001280:  20 20 2F 20 20 5F 5F 5F 7C 7C 20 20 5F 20 20 7C
F00:0104       		dc.b "\e[93m", "| |_/ / | | | | | \\ `--. | |/' |`' / /'| |/' |\n"
               S01:0000129F:  1B 5B 39 33 6D
               S01:000012A4:  7C 20 7C 5F 2F 20 2F 20 7C 20 7C 20 7C 20 7C 20
               S01:000012B4:  7C 20 5C 20 60 2D 2D 2E 20 7C 20 7C 2F 27 20 7C
F00:0105       		dc.b "\e[94m", "| ___ \\ | | | | | |`--. \\|  /| |  / /  |  /| |\n"
               S01:000012D3:  1B 5B 39 34 6D
               S01:000012D8:  7C 20 5F 5F 5F 20 5C 20 7C 20 7C 20 7C 20 7C 20
               S01:000012E8:  7C 20 7C 60 2D 2D 2E 20 5C 7C 20 20 2F 7C 20 7C
F00:0106       		dc.b "\e[95m", "| |_/ /_| |_\\ \\_/ /\\__/ /\\ |_/ /./ /___\\ |_/ /\n"
               S01:00001307:  1B 5B 39 35 6D
               S01:0000130C:  7C 20 7C 5F 2F 20 2F 5F 7C 20 7C 5F 5C 20 5C 5F
               S01:0000131C:  2F 20 2F 5C 5F 5F 2F 20 2F 5C 20 7C 5F 2F 20 2F
F00:0107       		dc.b "\e[96m", "\\____/ \\___/ \\___/\\____/  \\___/ \\_____/ \\___/"
               S01:0000133B:  1B 5B 39 36 6D
               S01:00001340:  5C 5F 5F 5F 5F 2F 20 5C 5F 5F 5F 2F 20 5C 5F 5F
               S01:00001350:  5F 2F 5C 5F 5F 5F 5F 2F 20 20 5C 5F 5F 5F 2F 20
F00:0108       		dc.b "\e[0m\n\n", $00
               S01:0000136D:  1B 5B 30 6D 0A 0A
               S01:00001373:  00
F00:0109       	.text2:
F00:0110       		dc.b "\e[1m", "Bootblocks found:", "\e[0m", $00
               S01:00001374:  1B 5B 31 6D
               S01:00001378:  42 6F 6F 74 62 6C 6F 63 6B 73 20 66 6F 75 6E 64
               S01:00001388:  3A
               S01:00001389:  1B 5B 30 6D
               S01:0000138D:  00
F00:0111       	.text1:
F00:0112       		dc.b "This is test. Hello world!\n", $00
               S01:0000138E:  54 68 69 73 20 69 73 20 74 65 73 74 2E 20 48 65
               S01:0000139E:  6C 6C 6F 20 77 6F 72 6C 64 21 0A
               S01:000013A9:  00
F00:0113       
F00:0114       	.textCommandTest:
F00:0115       		dc.b "test", $00
               S01:000013AA:  74 65 73 74
               S01:000013AE:  00
F00:0116       	.textCommandIntro:
F00:0117       		dc.b "intro", $00
               S01:000013AF:  69 6E 74 72 6F
               S01:000013B4:  00
F00:0118       	.textCommandnotfound:
F00:0119       		dc.b "Error: not a valid command!\n", $00
               S01:000013B5:  45 72 72 6F 72 3A 20 6E 6F 74 20 61 20 76 61 6C
               S01:000013C5:  69 64 20 63 6F 6D 6D 61 6E 64 21 0A
               S01:000013D1:  00
F00:0120       
F00:0121       	even
F00:0122       
F00:0123       
F00:0124       
F00:0125       getBootblockCount:
F00:0126       		move.l #12345, D0
               S01:000013D2:  20 3C 00 00 30 39
F00:0127       		rts
               S01:000013D8:  4E 75
F00:0128       
F00:0129       
F00:0130       BIOS_END:
F00:0131       ;Alignment hack because madmac does not support alignment to an arbitary size
F00:0132       ;This align is needed because right after the bios follows the first bootblock but that has to be aligned to 256 bytes b
F00:0133       ;(actually 128 bytes per page but because we use two eeproms (29ee010) in tandem the page size is twice as large)
F00:0134       ;If the target to compile to has a different page size this has to be changed
F00:0135       if ((BIOS_END & $ff) != 0) ;check if alligned to 256 byte boundry
F00:0136       	ds.b 256 - (BIOS_END & $ff) ;if not alligned then add filler
F00:0137       endif
F00:0138       print "BIOS_END: ", /d/l BIOS_END
F00:0139       
F00:0140       FIRST_BOOTBLOCK:
F00:0141       ;the first bootblock starts here
F00:0142       print "FIRST_BOOTBLOCK: ", /d/l FIRST_BOOTBLOCK
F00:0143       print "Filled bytes: ", /d FIRST_BOOTBLOCK - BIOS_END
F00:0144       
F00:0145       .include "ramdefs.asm"
F08:0001       abs RAM_BASE
F08:0002       
F08:0003       __SerialRingbuffer: ;clean ringbuffer
F08:0004       		ds.w 256
F08:0005       __SerialRBRead: ;read index into ringbuffer
F08:0006       		ds.w 1
F08:0007       __SerialRBWrite: ;write index into ringbuffer
F08:0008       		ds.w 1
F08:0009       __CommandBuffer:
F08:0010       		ds.w 256
F08:0011       
F00:0146       


Sections:
S01  seg0


Sources:
F00  main.asm
F01  system.asm
F02  vector.asm
F03  serial.asm
F04  ide.asm
F05  updater.asm
F06  compostfetch.asm
F07  string.asm
F08  ramdefs.asm


Symbols:
FIRST_BOOTBLOCK EXPR(5120=0x1400) ABS 
BIOS_END EXPR(5082=0x13da) ABS 
 Main .text1 EXPR(5006=0x138e) ABS 
 Main .textCommandnotfound EXPR(5045=0x13b5) ABS 
 Main .commandIntro EXPR(4638=0x121e) ABS 
 Main .textCommandIntro EXPR(5039=0x13af) ABS 
 Main .commandTest EXPR(4614=0x1206) ABS 
 Main .textCommandTest EXPR(5034=0x13aa) ABS 
 Main .cmdInterpret EXPR(4540=0x11bc) ABS 
 Main .cmdLoop EXPR(4506=0x119a) ABS 
__CommandBuffer EXPR(268435972=0x10000204) 
getBootblockCount EXPR(5074=0x13d2) ABS 
 Main .text2 EXPR(4980=0x1374) ABS 
 Main .text0 EXPR(4662=0x1236) ABS 
 StringCompare .exit EXPR(4416=0x1140) ABS 
 StringCompare .loop EXPR(4396=0x112c) ABS 
StringCompare EXPR(4386=0x1122) ABS 
CompostFetch EXPR(2718=0xa9e) ABS 
 UpdaterInit .text1 EXPR(1712=0x6b0) ABS 
 UpdaterInit .payload_end EXPR(2718=0xa9e) ABS 
 UpdaterInit .loop EXPR(1660=0x67c) ABS 
 UpdaterInit .payload_start EXPR(1730=0x6c2) ABS 
 UpdaterInit .text0 EXPR(1688=0x698) ABS 
UpdaterInit EXPR(1638=0x666) ABS 
IdeInit EXPR(1636=0x664) UNUSED ABS 
 SerialHexdump .outLoop EXPR(1572=0x624) ABS 
 SerialHexdump .text EXPR(1632=0x660) ABS 
 SerialHexdump .exit EXPR(1628=0x65c) ABS 
 SerialHexdump .lineLoop EXPR(1518=0x5ee) ABS 
SerialHexdump EXPR(1506=0x5e2) UNUSED ABS 
 SerialRead .return EXPR(1504=0x5e0) ABS 
SerialRead EXPR(1470=0x5be) ABS 
__SerialRBRead EXPR(268435968=0x10000200) 
SerialAvailable EXPR(1450=0x5aa) ABS 
__SerialRBWrite EXPR(268435970=0x10000202) 
__SerialRingbuffer EXPR(268435456=0x10000000) 
SerialWriteDec16 EXPR(1382=0x566) UNUSED ABS 
 SerialWriteDec32 .waitMfp EXPR(1354=0x54a) ABS 
 SerialWriteDec32 .return EXPR(1378=0x562) ABS 
 SerialWriteDec32 .display EXPR(1344=0x540) ABS 
 SerialWriteDec32 .divLoop EXPR(1326=0x52e) ABS 
SerialWriteDec32 EXPR(1316=0x524) ABS 
SerialWriteHex32 EXPR(1290=0x50a) ABS 
SerialWriteHex16 EXPR(1254=0x4e6) ABS 
 SerialWriteHex8 .loop1 EXPR(1224=0x4c8) ABS 
 SerialWriteHex8 .loop0 EXPR(1194=0x4aa) ABS 
SerialWriteHex8 EXPR(1190=0x4a6) ABS 
__SerialHexTable EXPR(1174=0x496) ABS 
SerialWriteChar EXPR(1150=0x47e) ABS 
 SerialWrite .return EXPR(1148=0x47c) ABS 
 SerialWrite .loop EXPR(1120=0x460) ABS 
SerialWrite EXPR(1116=0x45c) ABS 
SerialInit EXPR(1034=0x40a) ABS 
SerialRXHandler EXPR(1398=0x576) ABS 
IgnoreInterrupt EXPR(1032=0x408) ABS 
FatalError EXPR(1024=0x400) ABS 
Main EXPR(4420=0x1144) ABS 
IDE_LBAH EXPR(536870922=0x2000000a) UNUSED EQU 
IDE_LBAM EXPR(536870920=0x20000008) UNUSED EQU 
IDE_LBAL EXPR(536870918=0x20000006) UNUSED EQU 
IDE_DRVA EXPR(805306382=0x3000000e) UNUSED EQU 
IDE_DIGO EXPR(805306380=0x3000000c) UNUSED EQU 
IDE_ASTAT EXPR(805306380=0x3000000c) UNUSED EQU 
IDE_CMD EXPR(536870926=0x2000000e) UNUSED EQU 
IDE_WP EXPR(536870914=0x20000002) UNUSED EQU 
IDE_STAT EXPR(536870926=0x2000000e) UNUSED EQU 
IDE_SDH EXPR(536870924=0x2000000c) UNUSED EQU 
IDE_CH EXPR(536870922=0x2000000a) UNUSED EQU 
IDE_CL EXPR(536870920=0x20000008) UNUSED EQU 
IDE_SN EXPR(536870918=0x20000006) UNUSED EQU 
IDE_SC EXPR(536870916=0x20000004) UNUSED EQU 
IDE_E EXPR(536870914=0x20000002) UNUSED EQU 
IDE_D EXPR(536870912=0x20000000) UNUSED EQU 
MFP_UDR EXPR(1073741847=0x40000017) EQU 
MFP_TSR EXPR(1073741846=0x40000016) EQU 
MFP_RSR EXPR(1073741845=0x40000015) EQU 
MFP_UCR EXPR(1073741844=0x40000014) EQU 
MFP_SCR EXPR(1073741843=0x40000013) UNUSED EQU 
MFP_TDDR EXPR(1073741842=0x40000012) EQU 
MFP_TCDR EXPR(1073741841=0x40000011) UNUSED EQU 
MFP_TBDR EXPR(1073741840=0x40000010) UNUSED EQU 
MFP_TADR EXPR(1073741839=0x4000000f) UNUSED EQU 
MFP_TCDCR EXPR(1073741838=0x4000000e) EQU 
MFP_TBCR EXPR(1073741837=0x4000000d) UNUSED EQU 
MFP_TACR EXPR(1073741836=0x4000000c) UNUSED EQU 
MFP_VR EXPR(1073741835=0x4000000b) EQU 
MFP_IMRB EXPR(1073741834=0x4000000a) UNUSED EQU 
MFP_IMRA EXPR(1073741833=0x40000009) EQU 
MFP_ISRB EXPR(1073741832=0x40000008) UNUSED EQU 
MFP_ISRA EXPR(1073741831=0x40000007) UNUSED EQU 
MFP_IPRB EXPR(1073741830=0x40000006) UNUSED EQU 
MFP_IPRA EXPR(1073741829=0x40000005) UNUSED EQU 
MFP_IERB EXPR(1073741828=0x40000004) UNUSED EQU 
MFP_IERA EXPR(1073741827=0x40000003) EQU 
MFP_DDR EXPR(1073741826=0x40000002) EQU 
MFP_AER EXPR(1073741825=0x40000001) UNUSED EQU 
MFP_GPDR EXPR(1073741824=0x40000000) EQU 
STACK_INIT EXPR(269484032=0x10100000) EQU 
IDE1_BASE EXPR(805306368=0x30000000) EQU 
IDE0_BASE EXPR(536870912=0x20000000) EQU 
MFP_BASE EXPR(1073741824=0x40000000) EQU 
RAM_PAGES EXPR(1024=0x400) UNUSED EQU 
RAM_TOP EXPR(269484032=0x10100000) EQU 
RAM_SIZE EXPR(1048576=0x100000) EQU 
RAM_BASE EXPR(268435456=0x10000000) EQU 
ROM_TOP EXPR(262144=0x40000) UNUSED EQU 
ROM_SIZE EXPR(262144=0x40000) EQU 
ROM_BASE EXPR(0=0x0) EQU 
_MOVEMBYTES EXPR(0=0x0) INTERNAL 
 MOVEMSIZE EXPR(0=0x0) INTERNAL 
_MOVEMREGS EXPR(0=0x0) INTERNAL 
__VASM EXPR(4=0x4) INTERNAL 
__UNIXFS EXPR(0=0x0) INTERNAL 

There have been no errors.
